<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Electronics Inventory Manager Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html { overflow-y: scroll; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .spin { animation: spin 1s linear infinite; }
        .gradient-bg { background: linear-gradient(135deg, #0f172a 0%, #334155 100%); } /* Darker professional theme */
        .glass { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); }
        .shadow-custom { box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2); }
        
        /* Tab Styles */
        .tab-btn { border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab-btn.active { border-bottom-color: #4f46e5; color: #4f46e5; font-weight: bold; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-slate-800">
    <div id="app"></div>

    <script>
        // --- CONFIGURATION ---
        var APP_PASSWORD = 'IV9769806390D';
        var categories = ['Microcontroller', 'Display', 'Sensor', 'LED', 'Resistor', 'Capacitor', 'IC', 'Module', 'Buzzer', 'Motor', 'Power Supply', 'Transistor', 'Diode', 'Connector', 'Other'];

        // --- STATE MANAGEMENT ---
        var state = {
            activeTab: 'inventory', // 'inventory' or 'logs'
            components: [],
            transactions: [], // Stores the ledger
            searchTerm: '',
            filterCategory: 'All',
            isAuthenticated: false,
            loading: false,
            showAddModal: false,
            showSetupModal: false,
            editingId: null,
            dbConfig: { url: '', key: '' },
            formData: { 
                name: '', category: 'Microcontroller', value: '', quantity: '', 
                location: '', notes: '', datePurchased: '', 
                cost: '', minStock: '5', datasheet: '' 
            }
        };

        // --- INIT ---
        function init() {
            var auth = sessionStorage.getItem('auth');
            var savedConfig = localStorage.getItem('dbConfig');
            
            if (savedConfig) state.dbConfig = JSON.parse(savedConfig);
            
            if (auth === 'true') {
                state.isAuthenticated = true;
                if (state.dbConfig.url && state.dbConfig.key) {
                    loadData();
                }
            }
            render();
        }

        // --- DATABASE OPERATIONS ---
        function loadData() {
            state.loading = true;
            render();
            
            // Promise.all to load both inventory and logs at once
            var p1 = fetch(state.dbConfig.url + '/rest/v1/components?select=*&order=name.asc', {
                headers: { 'apikey': state.dbConfig.key, 'Authorization': 'Bearer ' + state.dbConfig.key }
            }).then(r => r.json());

            var p2 = fetch(state.dbConfig.url + '/rest/v1/transactions?select=*,components(name)&order=created_at.desc&limit=50', {
                headers: { 'apikey': state.dbConfig.key, 'Authorization': 'Bearer ' + state.dbConfig.key }
            }).then(r => r.json());

            Promise.all([p1, p2]).then(function(results) {
                state.components = results[0];
                state.transactions = results[1];
                state.loading = false;
                render();
            }).catch(function(e) {
                console.error(e);
                state.loading = false;
                render();
            });
        }

        function saveTransaction(compId, type, qty, reason) {
            var log = {
                component_id: compId,
                change_type: type,
                quantity_changed: qty,
                reason: reason
            };
            fetch(state.dbConfig.url + '/rest/v1/transactions', {
                method: 'POST',
                headers: { 'apikey': state.dbConfig.key, 'Authorization': 'Bearer ' + state.dbConfig.key, 'Content-Type': 'application/json' },
                body: JSON.stringify(log)
            }).then(() => loadData()); // Reload to show update in logs
        }

        function handleQuickAction(id, type) {
            var comp = state.components.find(c => c.id === id);
            if (!comp) return;

            var change = 0;
            var reason = "Quick Update";

            if (type === 'IN') {
                change = 1;
                reason = "Restock (+1)";
            } else {
                change = -1;
                if (comp.quantity <= 0) return alert('No stock left to remove!');
                // For professional logs, ask why items are being removed
                var input = prompt("Reason for using this component?", "Project use");
                if (input === null) return; // Cancelled
                reason = input || "Used (-1)";
            }

            var newQty = comp.quantity + change;

            // 1. Update Component Quantity
            fetch(state.dbConfig.url + '/rest/v1/components?id=eq.' + id, {
                method: 'PATCH',
                headers: { 'apikey': state.dbConfig.key, 'Authorization': 'Bearer ' + state.dbConfig.key, 'Content-Type': 'application/json' },
                body: JSON.stringify({ quantity: newQty })
            }).then(function(r) {
                if (r.ok) {
                    // 2. If successful, Add Log Entry
                    saveTransaction(id, type, Math.abs(change), reason);
                }
            });
        }

        function saveComponent(method, id) {
            method = method || 'POST';
            
            // Sanitize inputs
            var cost = parseFloat(state.formData.cost) || 0;
            var min = parseInt(state.formData.minStock) || 5;

            var comp = {
                name: state.formData.name,
                category: state.formData.category,
                value: state.formData.value,
                quantity: parseInt(state.formData.quantity),
                location: state.formData.location,
                notes: state.formData.notes,
                date_purchased: state.formData.datePurchased || null,
                cost_per_unit: cost,
                min_stock_level: min,
                datasheet_url: state.formData.datasheet
            };
            
            if (method === 'POST') comp.date_added = new Date().toISOString();

            var url = method === 'PATCH' ? state.dbConfig.url + '/rest/v1/components?id=eq.' + id : state.dbConfig.url + '/rest/v1/components';
            
            fetch(url, {
                method: method,
                headers: { 'apikey': state.dbConfig.key, 'Authorization': 'Bearer ' + state.dbConfig.key, 'Content-Type': 'application/json', 'Prefer': 'return=representation' },
                body: JSON.stringify(comp)
            }).then(function(r) {
                if (r.ok) {
                    // Log the creation
                    r.json().then(data => {
                        var newId = data[0].id; // Supabase returns array
                        saveTransaction(id || newId, 'IN', comp.quantity, method === 'POST' ? 'Initial Import' : 'Edit Update');
                    });
                    state.showAddModal = false;
                    resetForm();
                } else {
                    alert('Error saving. Check console.');
                }
            });
        }

        function deleteComponent(id) {
            if (!confirm('Delete this component and all its logs?')) return;
            fetch(state.dbConfig.url + '/rest/v1/components?id=eq.' + id, {
                method: 'DELETE',
                headers: { 'apikey': state.dbConfig.key, 'Authorization': 'Bearer ' + state.dbConfig.key }
            }).then(() => loadData());
        }

        // --- AUTH & CONFIG ---
        function handleLogin() {
            var pw = document.getElementById('password').value;
            if (pw === APP_PASSWORD) {
                state.isAuthenticated = true;
                sessionStorage.setItem('auth', 'true');
                if (state.dbConfig.url) loadData();
                else { state.showSetupModal = true; render(); }
            } else { alert('Incorrect password!'); }
        }

        function saveDbConfig() {
            if (!state.dbConfig.url || !state.dbConfig.key) return alert('Missing fields');
            state.dbConfig.url = state.dbConfig.url.replace(/\/$/, "");
            localStorage.setItem('dbConfig', JSON.stringify(state.dbConfig));
            state.showSetupModal = false;
            loadData();
        }

        // --- UI HELPERS ---
        function handleEditClick(id) {
            var comp = state.components.find(c => c.id === id);
            if (!comp) return;
            state.formData = {
                name: comp.name, category: comp.category, value: comp.value || '',
                quantity: comp.quantity, location: comp.location || '', notes: comp.notes || '',
                datePurchased: comp.date_purchased || '',
                cost: comp.cost_per_unit || '', minStock: comp.min_stock_level || 5,
                datasheet: comp.datasheet_url || ''
            };
            state.editingId = comp.id;
            state.showAddModal = true;
            render();
        }

        function resetForm() {
            state.formData = { name: '', category: 'Microcontroller', value: '', quantity: '', location: '', notes: '', datePurchased: '', cost: '', minStock: '5', datasheet: '' };
            state.editingId = null;
            render();
        }

        function getStats() {
            var totalQty = 0;
            var totalVal = 0;
            var lowStock = 0;
            
            state.components.forEach(c => {
                totalQty += c.quantity;
                totalVal += (c.quantity * (c.cost_per_unit || 0));
                if (c.quantity <= (c.min_stock_level || 5)) lowStock++;
            });
            
            return { totalQty, totalVal, lowStock };
        }

        function esc(txt) { return txt ? document.createElement('div').appendChild(document.createTextNode(txt)).parentNode.innerHTML : ''; }

        function formatDate(isoStr) {
            if (!isoStr) return '-';
            return new Date(isoStr).toLocaleDateString() + ' ' + new Date(isoStr).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        // --- RENDERER ---
        function render() {
            var activeId = document.activeElement ? document.activeElement.id : null;
            var app = document.getElementById('app');

            if (!state.isAuthenticated) {
                app.innerHTML = `<div class="min-h-screen flex items-center justify-center p-4"><div class="glass rounded-2xl shadow-custom p-8 w-full max-w-md fade-in text-center"><h1 class="text-3xl font-bold mb-2 text-slate-800">Inventory Pro</h1><p class="text-slate-500 mb-6">System Access</p><input type="password" id="password" class="w-full p-3 border rounded-xl mb-4 bg-slate-50" placeholder="Password" onkeypress="if(event.key==='Enter')handleLogin()"><button onclick="handleLogin()" class="w-full bg-slate-800 text-white p-3 rounded-xl font-bold hover:bg-slate-700 transition">Enter System</button></div></div>`;
                return;
            }

            var stats = getStats();
            var content = '';

            // --- HEADER & TABS ---
            var header = `
                <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <div>
                        <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Inventory Manager</h1>
                        <div class="flex gap-4 mt-2 text-sm text-slate-500">
                            <span>üì¶ ${stats.totalQty} Units</span>
                            <span>üí∞ $${stats.totalVal.toFixed(2)} Value</span>
                            ${stats.lowStock > 0 ? `<span class="text-red-600 font-bold">‚ö†Ô∏è ${stats.lowStock} Low Stock</span>` : '<span class="text-green-600">‚úî Stock Healthy</span>'}
                        </div>
                    </div>
                    <div class="flex bg-slate-100 p-1 rounded-lg">
                        <button onclick="state.activeTab='inventory';render()" class="tab-btn px-6 py-2 rounded-md ${state.activeTab==='inventory'?'bg-white shadow-sm font-bold text-slate-800':'text-slate-500 hover:text-slate-700'}">Inventory</button>
                        <button onclick="state.activeTab='logs';render()" class="tab-btn px-6 py-2 rounded-md ${state.activeTab==='logs'?'bg-white shadow-sm font-bold text-slate-800':'text-slate-500 hover:text-slate-700'}">Logs</button>
                    </div>
                </div>`;

            // --- INVENTORY VIEW ---
            if (state.activeTab === 'inventory') {
                var filtered = state.components.filter(c => {
                    var term = state.searchTerm.toLowerCase();
                    var matchSearch = c.name.toLowerCase().includes(term) || (c.value && c.value.toLowerCase().includes(term)) || (c.location && c.location.toLowerCase().includes(term));
                    var matchCat = state.filterCategory === 'All' || c.category === state.filterCategory;
                    return matchSearch && matchCat;
                });

                var rows = filtered.map(c => `
                    <tr class="border-b border-slate-100 hover:bg-slate-50 transition">
                        <td class="p-4">
                            <div class="font-bold text-slate-800">${esc(c.name)}</div>
                            <div class="text-xs text-slate-400">${esc(c.category)}</div>
                        </td>
                        <td class="p-4 text-sm">${esc(c.value || '-')}</td>
                        <td class="p-4">
                            <div class="flex items-center gap-2">
                                <button onclick="handleQuickAction(${c.id}, 'OUT')" class="w-6 h-6 rounded-full bg-red-100 text-red-600 hover:bg-red-200 flex items-center justify-center font-bold text-sm">-</button>
                                <span class="font-mono font-bold ${c.quantity <= (c.min_stock_level||5) ? 'text-red-600' : 'text-slate-700'} w-8 text-center">${c.quantity}</span>
                                <button onclick="handleQuickAction(${c.id}, 'IN')" class="w-6 h-6 rounded-full bg-green-100 text-green-600 hover:bg-green-200 flex items-center justify-center font-bold text-sm">+</button>
                            </div>
                        </td>
                        <td class="p-4 text-sm text-slate-500">${esc(c.location || '-')}</td>
                        <td class="p-4 text-sm">$${(c.cost_per_unit||0).toFixed(2)}</td>
                        <td class="p-4">
                            <div class="flex gap-2 justify-end">
                                ${c.datasheet_url ? `<a href="${c.datasheet_url}" target="_blank" class="p-2 text-slate-400 hover:text-blue-600" title="Datasheet"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg></a>` : ''}
                                <button onclick="handleEditClick(${c.id})" class="p-2 text-slate-400 hover:text-blue-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg></button>
                                <button onclick="deleteComponent(${c.id})" class="p-2 text-slate-400 hover:text-red-600"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
                            </div>
                        </td>
                    </tr>
                `).join('');

                content = `
                    <div class="flex flex-col md:flex-row gap-4 mb-6">
                        <div class="relative flex-1">
                            <input type="text" id="searchInput" oninput="state.searchTerm=this.value;render()" value="${state.searchTerm}" placeholder="Search components, values, locations..." class="w-full pl-10 pr-4 py-3 bg-slate-50 border-0 rounded-xl focus:ring-2 focus:ring-indigo-500 transition">
                            <svg class="w-5 h-5 text-slate-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                        </div>
                        <select onchange="state.filterCategory=this.value;render()" class="px-4 py-3 bg-slate-50 border-0 rounded-xl focus:ring-2 focus:ring-indigo-500 font-medium text-slate-600">
                            <option value="All">All Categories</option>
                            ${categories.map(c => `<option value="${c}" ${state.filterCategory===c?'selected':''}>${c}</option>`).join('')}
                        </select>
                        <button onclick="state.showAddModal=true;render()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg> Add Item
                        </button>
                    </div>
                    <div class="overflow-x-auto rounded-xl border border-slate-100 shadow-sm">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-slate-500 text-xs uppercase font-bold tracking-wider">
                                <tr>
                                    <th class="p-4">Component</th>
                                    <th class="p-4">Spec</th>
                                    <th class="p-4">Stock</th>
                                    <th class="p-4">Loc</th>
                                    <th class="p-4">Cost</th>
                                    <th class="p-4 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-slate-100">${rows || '<tr><td colspan="6" class="p-8 text-center text-slate-400">No components found</td></tr>'}</tbody>
                        </table>
                    </div>`;
            } 
            // --- LEDGER VIEW ---
            else {
                var logs = state.transactions.map(t => {
                    var isIn = t.change_type === 'IN';
                    return `
                    <tr class="border-b border-slate-100 hover:bg-slate-50">
                        <td class="p-4 text-sm text-slate-500">${formatDate(t.created_at)}</td>
                        <td class="p-4 font-bold text-slate-700">${esc(t.components ? t.components.name : 'Deleted Item')}</td>
                        <td class="p-4"><span class="px-2 py-1 rounded text-xs font-bold ${isIn ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">${t.change_type}</span></td>
                        <td class="p-4 font-mono font-bold">${t.quantity_changed}</td>
                        <td class="p-4 text-sm text-slate-600">${esc(t.reason)}</td>
                    </tr>`;
                }).join('');

                content = `
                    <div class="overflow-hidden rounded-xl border border-slate-100 shadow-sm bg-white">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-slate-500 text-xs uppercase font-bold">
                                <tr>
                                    <th class="p-4">Date</th>
                                    <th class="p-4">Component</th>
                                    <th class="p-4">Action</th>
                                    <th class="p-4">Qty</th>
                                    <th class="p-4">Reason/Notes</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">${logs || '<tr><td colspan="5" class="p-8 text-center text-slate-400">No logs available</td></tr>'}</tbody>
                        </table>
                    </div>
                `;
            }

            // --- MAIN LAYOUT ---
            app.innerHTML = `
                <div class="min-h-screen p-4 md:p-8">
                    <div class="max-w-6xl mx-auto glass rounded-2xl shadow-custom p-6 md:p-8 fade-in">
                        ${header}
                        ${content}
                        <div class="mt-6 flex justify-between text-xs text-slate-400">
                            <button onclick="state.showSetupModal=true;render()" class="hover:text-slate-600">‚öô Database Config</button>
                            <button onclick="loadData()" class="hover:text-slate-600 ${state.loading?'animate-pulse':''}">‚Üª Refresh Data</button>
                        </div>
                    </div>
                </div>
                ${renderAddModal()}
                ${renderSetupModal()}
            `;
            
            if (activeId && document.getElementById(activeId)) document.getElementById(activeId).focus();
        }

        // --- MODAL RENDERERS ---
        function renderAddModal() {
            if (!state.showAddModal) return '';
            var catOpts = categories.map(c => `<option value="${c}" ${state.formData.category===c?'selected':''}>${c}</option>`).join('');
            
            return `
            <div class="fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50 backdrop-blur-sm fade-in" onclick="if(event.target===this){state.showAddModal=false;render()}">
                <div class="bg-white rounded-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl">
                    <h2 class="text-2xl font-bold mb-6 text-slate-800">${state.editingId ? 'Edit' : 'Add'} Component</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Name *</label>
                            <input type="text" autofocus class="w-full p-3 bg-slate-50 border rounded-lg" value="${esc(state.formData.name)}" oninput="state.formData.name=this.value">
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Category</label>
                            <select class="w-full p-3 bg-slate-50 border rounded-lg" onchange="state.formData.category=this.value">${catOpts}</select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Value/Spec</label>
                            <input type="text" class="w-full p-3 bg-slate-50 border rounded-lg" placeholder="10k, 12V..." value="${esc(state.formData.value)}" oninput="state.formData.value=this.value">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Quantity *</label>
                            <input type="number" class="w-full p-3 bg-slate-50 border rounded-lg" value="${esc(state.formData.quantity)}" oninput="state.formData.quantity=this.value">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Cost Per Unit ($)</label>
                            <input type="number" step="0.01" class="w-full p-3 bg-slate-50 border rounded-lg" placeholder="0.00" value="${esc(state.formData.cost)}" oninput="state.formData.cost=this.value">
                        </div>
                         <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Low Stock Alert Level</label>
                            <input type="number" class="w-full p-3 bg-slate-50 border rounded-lg" placeholder="Default: 5" value="${esc(state.formData.minStock)}" oninput="state.formData.minStock=this.value">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Storage Location</label>
                            <input type="text" class="w-full p-3 bg-slate-50 border rounded-lg" placeholder="Box A1" value="${esc(state.formData.location)}" oninput="state.formData.location=this.value">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Datasheet URL</label>
                            <input type="text" class="w-full p-3 bg-slate-50 border rounded-lg" placeholder="https://..." value="${esc(state.formData.datasheet)}" oninput="state.formData.datasheet=this.value">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Notes</label>
                            <textarea class="w-full p-3 bg-slate-50 border rounded-lg h-24 resize-none" oninput="state.formData.notes=this.value">${esc(state.formData.notes)}</textarea>
                        </div>
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button onclick="${state.editingId ? 'saveComponent(\'PATCH\', state.editingId)' : 'saveComponent()'}" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700">Save</button>
                        <button onclick="state.showAddModal=false;render()" class="flex-1 bg-slate-200 text-slate-700 py-3 rounded-lg font-bold hover:bg-slate-300">Cancel</button>
                    </div>
                </div>
            </div>`;
        }

        function renderSetupModal() {
            if (!state.showSetupModal) return '';
            return `
            <div class="fixed inset-0 bg-slate-900/50 flex items-center justify-center p-4 z-50 backdrop-blur-sm fade-in" onclick="if(event.target===this){state.showSetupModal=false;render()}">
                <div class="bg-white rounded-2xl p-6 w-full max-w-lg shadow-2xl">
                    <h2 class="text-xl font-bold mb-4">Database Connection</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Supabase URL</label>
                            <input type="text" class="w-full p-3 bg-slate-50 border rounded-lg" value="${esc(state.dbConfig.url)}" oninput="state.dbConfig.url=this.value">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">API Key</label>
                            <input type="text" class="w-full p-3 bg-slate-50 border rounded-lg" value="${esc(state.dbConfig.key)}" oninput="state.dbConfig.key=this.value">
                        </div>
                        <div class="bg-blue-50 text-blue-800 p-3 rounded text-sm">
                             Ensure you have run the new SQL queries for the transactions table and new columns!
                        </div>
                    </div>
                    <div class="flex gap-3 mt-6">
                        <button onclick="saveDbConfig()" class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-bold">Connect</button>
                        <button onclick="state.showSetupModal=false;render()" class="flex-1 bg-slate-200 text-slate-700 py-3 rounded-lg font-bold">Cancel</button>
                    </div>
                </div>
            </div>`;
        }

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
